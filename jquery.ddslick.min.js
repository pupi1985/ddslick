(function(e){function s(e,t){var n=e.find(".dd-option-value[value= '"+t+"']").parents("li").prevAll().length;o(e,n)}function o(e,t){var n=e.data("ddslick");var r=e.find(".dd-selected"),i=r.siblings(".dd-selected-value"),s=e.find(".dd-options"),o=r.siblings(".dd-pointer"),u=e.find(".dd-option").eq(t),l=u.closest("li"),c=n.settings,h=n.settings.data[t];e.find(".dd-option").removeClass("dd-option-selected");u.addClass("dd-option-selected");n.selectedIndex=t;n.selectedItem=l;n.selectedData=h;if(c.showSelectedHTML){r.html((h.cssSprite?'<span class="dd-selected-csssprite'+(c.imagePosition=="right"?" dd-image-right "+h.cssSprite:" dd-image-left "+h.cssSprite)+'" />':"")+(h.imageSrc?'<img class="dd-selected-image'+(c.imagePosition=="right"?" dd-image-right":"")+'" src="'+h.imageSrc+'" />':"")+(h.text?'<label class="dd-selected-text">'+h.text+"</label>":"")+(h.description?'<small class="dd-selected-description dd-desc'+(c.truncateDescription?" dd-selected-description-truncated":"")+'" >'+h.description+"</small>":""))}else r.html(h.text);i.val(h.value);n.original.val(h.value);e.data("ddslick",n);a(e,n);f(e);if(typeof c.onSelected==="function"){c.onSelected.call(this,n)}}function u(t){var n=t.find(".dd-select"),r=n.siblings(".dd-options"),i=n.find(".dd-pointer"),s=r.is(":visible");e(".dd-click-off-close").not(r).slideUp(50);e(".dd-pointer").removeClass("dd-pointer-up");n.removeClass("dd-open");if(s){r.slideUp(50,function(){var e=t.data("ddslick");c(e)});i.removeClass("dd-pointer-up");n.removeClass("dd-open")}else{n.addClass("dd-open");r.slideDown("fast");i.addClass("dd-pointer-up")}l(t)}function a(e,t){e.find(".dd-select").removeClass("dd-open");e.find(".dd-options").slideUp(50,function(){c(t)});e.find(".dd-pointer").removeClass("dd-pointer-up").removeClass("dd-pointer-up")}function f(e){var t=e.find(".dd-select").css("height");var n=e.find(".dd-selected-description");var r=e.find(".dd-selected-image");var i=e.find(".dd-selected-csssprite");if(n.length<=0&&r.length>0||n.length<=0&&i.length>0){e.find(".dd-selected-text").css("lineHeight",t)}}function l(t){t.find(".dd-option").each(function(){var n=e(this);var r=n.css("height");var i=n.find(".dd-option-description");var s=t.find(".dd-option-image");var o=t.find(".dd-selected-csssprite");if(i.length<=0&&s.length>0||i.length<=0&&o.length>0){n.find(".dd-option-text").css("lineHeight",r)}})}function c(e){if(typeof e.settings.onClosed==="function"){e.settings.onClosed.call(this,e)}}e.fn.ddslick=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exists.")}};var t={},n={data:[],keepJSONItemsOnTop:false,width:260,height:null,background:"#eee",selectText:"",defaultSelectedIndex:null,truncateDescription:true,imagePosition:"left",showSelectedHTML:true,clickOffToClose:true,embedCSS:true,onSelected:function(){},onClosed:function(){}},r='<ul class="dd-options"></ul>',i='<style id="css-ddslick" type="text/css">'+".dd-select{border-radius:2px;border:solid 1px #ccc;position:relative;cursor:pointer}"+".dd-desc{color:#aaa;display:block;overflow:hidden;font-weight:normal;line-height:1.4em}"+".dd-selected{overflow:hidden;display:block;padding:10px;font-weight:bold}"+".dd-pointer{width:0;height:0;position:absolute;right:10px;top:50%;margin-top:-3px}"+".dd-pointer-down{border:solid 5px transparent;border-top:solid 5px #000}"+".dd-pointer-up{border:solid 5px transparent!important;border-bottom:solid 5px #000!important;margin-top:-8px}"+".dd-options{border:solid 1px #ccc;border-top:none;list-style:none;box-shadow:0 1px 5px #ddd;display:none;position:absolute;z-index:2000;margin:0;padding:0;background:#fff;overflow:auto}"+".dd-option{padding:10px;display:block;border-bottom:solid 1px #ddd;overflow:hidden;text-decoration:none;color:#333;cursor:pointer;-webkit-transition:all .25s ease-in-out;-moz-transition:all .25s ease-in-out;-o-transition:all .25s ease-in-out;-ms-transition:all .25s ease-in-out}"+".dd-options > li:last-child > .dd-option{border-bottom:none}"+".dd-option:hover{background:#f3f3f3;color:#000}"+".dd-selected-description-truncated{text-overflow:ellipsis;white-space:nowrap}"+".dd-option-selected{background:#f6f6f6}"+".dd-option-image,.dd-selected-image,.dd-selected-csssprite,.dd-image-left{vertical-align:middle;float:left;margin-right:5px;max-width:64px}"+".dd-image-right{float:right;margin-right:15px;margin-left:5px}"+".dd-container{position:relative}.dd-selected-text{font-weight:bold}</style>";t.init=function(t){var s=e.extend({},n,t);if(e("#css-ddslick").length<=0&&s.embedCSS){e(i).appendTo("head")}return this.each(function(){var i=e.extend({},n,t);var s=e(this),a=s.data("ddslick");if(!a){var f=[],l=i.data;s.find("option").each(function(){var t=e(this),n=t.data();f.push({text:e.trim(t.text()),value:t.val(),selected:t.is(":selected"),description:n.description,cssSprite:n.csssprite,imageSrc:n.imagesrc})});if(i.keepJSONItemsOnTop)e.merge(i.data,f);else i.data=e.merge(f,i.data);var h=s,p=e("<div>").attr("id",s.attr("id")+"-dd-placeholder");s.replaceWith(p);s=p;ddSelectHtml='<div class="dd-select"><input class="dd-selected-value" name="'+h.attr("name")+'" type="hidden" /><a class="dd-selected"></a><span class="dd-pointer dd-pointer-down"></span></div>';s.addClass("dd-container").append(ddSelectHtml).append(r);s.find("input.dd-selected-value").attr("id",e(h).attr("id")).attr("name",e(h).attr("name"));var f=s.find(".dd-select"),d=s.find(".dd-options");d.css({width:i.width});f.css({width:i.width,background:i.background});s.css({width:i.width});if(i.height!=null)d.css({height:i.height,overflow:"auto"});e.each(i.data,function(e,t){if(t.selected)i.defaultSelectedIndex=e;d.append("<li>"+'<a class="dd-option">'+(t.value?' <input class="dd-option-value" type="hidden" value="'+t.value+'" />':"")+(t.cssSprite?' <span class="dd-selected-csssprite'+(i.imagePosition=="right"?" dd-image-right "+t.cssSprite:" dd-image-left "+t.cssSprite)+'" />':"")+(t.imageSrc?' <img class="dd-option-image'+(i.imagePosition=="right"?" dd-image-right":"")+'" src="'+t.imageSrc+'" />':"")+(t.text?' <label class="dd-option-text">'+t.text+"</label>":"")+(t.description?' <small class="dd-option-description dd-desc">'+t.description+"</small>":"")+"</a>"+"</li>")});var v={settings:i,original:h,selectedIndex:-1,selectedItem:null,selectedData:null};s.data("ddslick",v);if(i.selectText.length>0&&i.defaultSelectedIndex==null){s.find(".dd-selected").html(i.selectText)}else{var m=i.defaultSelectedIndex!=null&&i.defaultSelectedIndex>=0&&i.defaultSelectedIndex<i.data.length?i.defaultSelectedIndex:0;o(s,m)}s.find(".dd-select").on("click.ddslick",function(){u(s)});s.find(".dd-option").on("click.ddslick",function(){o(s,e(this).closest("li").index())});if(i.clickOffToClose){d.addClass("dd-click-off-close");s.on("click.ddslick",function(e){e.stopPropagation()});e("body").on("click",function(){e(".dd-open").removeClass("dd-open");e(".dd-click-off-close").slideUp(50,function(){var e=s.data("ddslick");var t=d.is(":visible");if(e&&t){c(e)}}).siblings(".dd-select").find(".dd-pointer").removeClass("dd-pointer-up")})}}})};t.select=function(t){return this.each(function(){if(t.index!==undefined)o(e(this),t.index);if(t.id)s(e(this),t.id)})};t.open=function(){return this.each(function(){var t=e(this),n=t.data("ddslick");if(n)u(t)})};t.close=function(){return this.each(function(){var t=e(this),n=t.data("ddslick");if(n)a(t,n)})};t.destroy=function(){return this.each(function(){var t=e(this),n=t.data("ddslick");if(n){var r=n.original;t.removeData("ddslick").unbind(".ddslick").replaceWith(r)}})}})(jQuery)
